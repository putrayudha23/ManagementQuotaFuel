{% extends 'base.html' %}
{% load static %}

{% block title %}
  <title>Knowflow Web | Product Master</title>
{% endblock %}

{% block header %}
  <a href="#" class="navbar-brand">KNOWFLOW WEB</a>
{% endblock %}

{% block username %}
<a class="nav-link" data-toggle="dropdown" href="#">
  <img src="{% static 'dist/img/user.png' %}" width="32" height="32" class="rounded-circle" alt="User Image">
  <span class="ml-2 d-none d-lg-inline-block">{{user.get_full_name}}</span>
</a>
<form id="logout-form" method="POST" action="{% url 'logout' %}">
  {% csrf_token %}
  <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
    <a href="#" class="dropdown-item" onclick="showConfirmation(event)">
      <div class="media">
        <img src="{% static 'dist/img/log-out.png' %}" alt="Log Out" width="30" class="mr-3">
        <div class="media-body">
          <h6 class="mt-0 mb-1 font-weight-bold">Logout</h6>
        </div>
      </div>
    </a>
  </div>
</form>

<script>
  function showConfirmation(event) {
    event.preventDefault();
    if (confirm("Are you sure you want to logout?")) {
      // User clicked "OK"
      document.getElementById('logout-form').submit();
    } else {
      // User clicked "Cancel"
    }
  }
</script>
{% endblock %}

{% block sidebar %}
<div class="sidebar">
  <!-- Sidebar Menu -->
  <nav class="mt-2">
    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
      <li class="nav-header">TRANSPORTASI</li>
      <!-- Quota Transaction -->
      <li class="nav-item">
        <a href="/quotaTransaction" class="nav-link">
          <i class="nav-icon fas fa-car"></i>
          <p>
            Quota Transaction
          </p>
        </a>
      </li>
      <!-- Kuota Master -->
      <li class="nav-item">
        <a href="/kuotaMaster" class="nav-link">
          <i class="nav-icon fas fa-archive"></i>
          <p>
            Kuota Master
          </p>
        </a>
      </li>
      <!-- Vehicle Master -->
      <li class="nav-item">
        <a href="/vehicleMaster" class="nav-link">
          <i class="nav-icon fas fa-truck"></i>
          <p>
            Input ID Kendaraan
          </p>
        </a>
      </li>
      <!-- Import Vehicle Master -->
      <li class="nav-item">
        <a href="/importVehicleMaster" class="nav-link">
          <i class="nav-icon fas fa-upload"></i>
          <p>
            Upload ID Kendaraan
          </p>
        </a>
      </li>
      <!-- Vehicle Data -->
      <li class="nav-item">
        <a href="/vehicleData" class="nav-link">
          <i class="nav-icon fas fa-car-side"></i>
          <p>
            Vehicle Master
          </p>
        </a>
      </li>
      <!-- Vehicle Type Master -->
      <li class="nav-item">
        <a href="/vehicleTypeMaster" class="nav-link">
          <i class="nav-icon fas fa-truck-pickup"></i>
          <p>
            Vehicle Type Master
          </p>
        </a>
      </li>
      <!-- Site Master -->
      <li class="nav-item">
        <a href="/siteMaster" class="nav-link">
          <i class="nav-icon fas fa-map-marked-alt"></i>
          <p>
            Site Master
          </p>
        </a>
      </li>
      <!-- Product Master -->
      <li class="nav-item">
        <a href="/productMaster" class="nav-link active">
          <i class="nav-icon fas fa-cubes"></i>
          <p>
            Product Master
          </p>
        </a>
      </li>
      <!-- unblock -->
      <li class="nav-item">
        <a href="/unblock" class="nav-link">
          <i class="nav-icon fas fa-table"></i>
          <p>
            Data Bloking
          </p>
        </a>
      </li>
      <li class="nav-header">NON TRANSPORTASI</li>
      <li class="nav-item">
        <a href="/uploadExcelNonkendaraan" class="nav-link">
          <i class="nav-icon fas fa-file-excel"></i>
          <p>
            Upload Excel Data
          </p>
        </a>
      </li>
      <li class="nav-item">
        <a href="/inputDataDetailNonkendaraan" class="nav-link">
          <i class="nav-icon fas fa-edit"></i>
          <p>
            Input Data Detail
          </p>
        </a>
      </li>
      <li class="nav-item">
        <a href="/uploadSuratRekomNonkendaraan" class="nav-link">
          <i class="nav-icon fas fa-upload"></i>
          <p>
            Upload Surat Rekom
          </p>
        </a>
      </li>
      <li class="nav-item">
        <a href="/dataDetailNonkendaraan" class="nav-link">
          <i class="nav-icon fas fa-file-alt"></i>
          <p>
            Data Detail
          </p>
        </a>
      </li>
      <li class="nav-item">
        <a href="/transactionNonkendaraan" class="nav-link">
          <i class="nav-icon fas fa-exchange-alt"></i>
          <p>
            Transaction
          </p>
        </a>
      </li>
      <li class="nav-item">
        <a href="/generateScriptNonKendaraan" class="nav-link">
          <i class="nav-icon fas fa-code"></i>
          <p>
            Script Generator
          </p>
        </a>
      </li>
      <li class="nav-item">
        <a href="/dataBph" class="nav-link">
          <i class="nav-icon fas fa-table"></i>
          <p>
            Data BPH
          </p>
        </a>
      </li>
      <li class="nav-item">
        <a href="/dataOffline" class="nav-link">
          <i class="nav-icon fas fa-table"></i>
          <p>
            Ubah UUID
          </p>
        </a>
      </li>
      <li class="nav-item">
        <a href="/editExcelData" class="nav-link">
          <i class="nav-icon fas fa-table"></i>
          <p>
            Edit Excel Data
          </p>
        </a>
      </li>
      <!-- <li class="nav-item">
        <a href="/reportTransactionNonKendaraan" class="nav-link">
            <i class="nav-icon fas fa-database"></i>
            <p>
                Report Transaction
            </p>
        </a>
      </li> -->
      <li class="nav-header">USER</li>
      <!-- User Setting -->
      <li class="nav-item">
        <a href="/userSetting" class="nav-link">
          <i class="nav-icon fas fa-cogs"></i>
          <p>
            User Setting
          </p>
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.sidebar-menu -->
</div>
{% endblock %}

{% block header_page %}
  <h1 class="m-0">PRODUCT MASTER</h1>
{% endblock %}

{% block body %}
<!-- Search -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">Search Data</h3>
  </div>
  <div class="card-body">
    <form class="form-inline" method="post">
      {% csrf_token %}
      <div class="form-group">
        <label for="id_search" class="mr-2">ID Product: </label>
        <input type="number" class="form-control mr-2" name="id_search" id="id_search" min="0" max="999999999" step="1">
      </div>
      <button type="submit" class="btn btn-primary">Search</button>
    </form>
  </div>
</div>

<!-- Tabel -->
<style>
  table th,
  table td {
    white-space: nowrap;
  }

  .required-field {
    color: red;
    vertical-align: super;
  }
</style>

<div class="card">
    <div class="card-header">
      <h3 class="card-title">Table Product Master</h3>
    </div>
    <div class="card-body table-responsive">
      <table class="table table-striped" id="productTable">
        <thead>
          <tr>
            <th class="text-center">ID Product</th>
            <th class="text-center">Product Name</th>
            <th class="text-center">Description</th>
            <th class="text-center">Price</th>
            <th class="text-center">ID Quota</th>
            <th class="text-center">Date Time Start</th>
            <th class="text-center">Date Time End</th>
            <th class="text-center">Delete Status</th>
            <th class="text-center">Edit</th>
            <th class="text-center">Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for row in data %}
            <tr>
                <td class="text-center">{{ row.id }}</td>
                <td class="text-center">{{ row.name }}</td>
                <td class="text-center">{{ row.description }}</td>
                <td class="text-center">{{ row.price }}</td>
                <td class="text-center">{{ row.idquota }}</td>
                <td class="text-center">{{ row.datetimestart }}</td>
                <td class="text-center">{{ row.datetimeend }}</td>
                <td class="text-center">{{ row.deleted }}</td>
                <td class="text-center"><a class="btn btn-success" id="editBtn">Edit</a></td>
                <td class="text-center"><a class="btn btn-danger" href="{% url 'productMaster:delete' row.id %}" id="deleteBtn" type="Submit">Change Delete Status</a></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

<!-- Form -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">Add or Modify</h3>
  </div>
  <div class="card-body">
    <form method="POST">
      {% csrf_token %}
      <table class="table">
        <tr>
          <td>
            <div class="form-group">
              <label for="product_name">Product Name <span class="required-field"><sup style="font-size: 90%;">*</sup></span></label>
              <input type="text" class="form-control" id="product_name" name="product_name" required>
            </div>
          </td>
          <td colspan="2">
            <div class="form-group">
              <label for="description">Description <span class="required-field"><sup style="font-size: 90%;">*</sup></span></label>
              <input type="text" class="form-control" id="description" name="description" required>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="form-group">
              <label for="id_add">ID Product <span class="required-field"><sup style="font-size: 90%;">*</sup></span></label>
              <input type="number" class="form-control" id="id_add" name="id_add" min="0" max="999999999" step="1" required>
              <input type="hidden" class="form-control" id="id_modify" name="id_modify">
            </div>
          </td>
          <td>
            <div class="form-group">
              <label for="idquota">ID Quota <span class="required-field"><sup style="font-size: 90%;">*</sup></span></label>
              <input type="number" class="form-control" id="idquota" name="idquota" min="0" max="999999999" step="1" required>
            </div>
          </td>
          <td>
            <div class="form-group">
              <label for="idquota">Price <span class="required-field"><sup style="font-size: 90%;">*</sup></span></label>
              <input type="number" class="form-control" id="price" name="price" min="0" max="999999999" step="1" required>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="form-group">
              <label for="datetimestart">Start Date/Time:</label>
              <input type="datetime-local" id="datetimestart" name="datetimestart">
            </div>
          </td>
          <td>
            <div class="form-group">
              <label for="datetimeend">End Date/Time:</label>
              <input type="datetime-local" id="datetimeend" name="datetimeend">
            </div>
          </td>
          <td></td>
        </tr>
      </table>
      <button type="Submit" class="btn btn-primary" id="submitBtn">Submit</button>
      <button type="Submit" class="btn btn-success" id="modifyBtn" disabled>Modify</button>
      <button type="Button" class="btn btn-danger" id="cancelmodifyBtn" disabled>Cancel Modify</button>
    </form>
  </div>
</div>

<!-- // Import the moment.js library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<script>
  const editBtns = document.querySelectorAll("#editBtn");
  const productNameEntry = document.getElementById("product_name");
  const descriptionEntry = document.getElementById("description");
  const idQuotaEntry = document.getElementById("idquota");
  const priceEntry = document.getElementById("price");
  const datetimestartEntry = document.getElementById("datetimestart");
  const datetimeendEntry = document.getElementById("datetimeend");
  const id_entry_add = document.getElementById("id_add");
  const id_entry_modify = document.getElementById("id_modify");
  const submit_btn = document.getElementById("submitBtn");
  const modify_btn = document.getElementById("modifyBtn");
  const cancel_modify_btn = document.getElementById("cancelmodifyBtn");

  editBtns.forEach(function (btn) {
    btn.addEventListener("click", function () {
      // Remove the "selected" class from all rows
      editBtns.forEach(function (btn) {
        btn.closest("tr").classList.remove("selected");
      });
      // Add the "selected" class to the parent row of the clicked button
      this.closest("tr").classList.add("selected");

      // Get the data from the selected row
      const row = this.closest("tr");
      const idCell = row.querySelector("td:nth-child(1)");
      const productNameCell = row.querySelector("td:nth-child(2)");
      const descriptionCell = row.querySelector("td:nth-child(3)");
      const priceCell = row.querySelector("td:nth-child(4)");
      const idQuotaCell = row.querySelector("td:nth-child(5)");
      const datetimestartCell = row.querySelector("td:nth-child(6)");
      const datetimeendCell = row.querySelector("td:nth-child(7)");

      // Populate the input fields with the data from the selected row
      id_entry_add.value = idCell.innerText;
      id_entry_modify.value = idCell.innerText;
      productNameEntry.value = productNameCell.innerText;
      descriptionEntry.value = descriptionCell.innerText;
      idQuotaEntry.value = idQuotaCell.innerText;
      priceEntry.value = priceCell.innerText;

      // Parse the date string using moment.js and format it in the datetime-local format
      const datetimestart = moment(datetimestartCell.innerText, "MMMM D, YYYY, h:mm a").format("YYYY-MM-DDTHH:mm");
      const datetimeend = moment(datetimeendCell.innerText, "MMMM D, YYYY, h:mm a").format("YYYY-MM-DDTHH:mm");

      // Set the value of the input fields
      datetimestartEntry.value = datetimestart;
      datetimeendEntry.value = datetimeend;

      // Remove the "disabled" attribute from the input elements
      modify_btn.removeAttribute("disabled");
      cancel_modify_btn.removeAttribute("disabled");
      submit_btn.disabled = true;
      id_entry_add.disabled = true;

      // Scroll to the bottom of the page
      window.scrollTo(0, document.body.scrollHeight);
    });
  });

  cancel_modify_btn.addEventListener("click", function() {
    // Clear the input fields
    productNameEntry.value = "";
    descriptionEntry.value = "";
    idQuotaEntry.value = "";
    priceEntry.value = "";
    id_entry_add.value = "";
    id_entry_modify.value = "";
    datetimestartEntry.value = "";
    datetimeendEntry.value = "";

    // Disable the Modify and Cancel Modify buttons, and enable the Submit button
    modify_btn.disabled = true;
    cancel_modify_btn.disabled = true;
    submit_btn.disabled = false;
    id_entry_add.disabled = false;

    // Remove the "selected" class from all rows
    tableRows.forEach(function(row) {
      row.classList.remove("selected");
    });
  });

</script>

{% endblock %}
